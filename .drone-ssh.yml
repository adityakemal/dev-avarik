kind: pipeline
type: ssh
name: avariksaga-v2

clone:
  disable: true

server:
  host:
    from_secret: stag1Host
  user:
    from_secret: stag1User
  ssh_key:
    from_secret: stag1Pass

steps:
- name: Pull
  commands:
  - cd /prod/avariksaga-v2
  - sudo git pull
  when:
   event:
    - push
    - custom
   branch:
    - master
- name: Build
  commands:
  - cd /prod/avariksaga-v2
  - sudo npm run build
  - sudo pm2 reload 0
  when:
   event:
    - push
    - custom
   branch:
    - master

---
kind: pipeline
type: docker
name: notify-avariksaga-v2

clone:
  disable: true

steps:
- name: notify
  image: plugins/slack
  settings:
    webhook: 
      from_secret: drone-status
    channel: nft-avariksaga
    template: >
      {{#success build.status}}
       Project: {{repo.name}} 
       Branch: {{build.branch}}
       Commit: {{build.commit}}
       Event: {{build.event}} 
       Status: {{build.status}}
       Good Job :)
      {{else}}
       Project: {{repo.name}} 
       Branch: {{build.branch}}
       Commit: {{build.commit}}
       Event: {{build.event}} 
       Status: {{build.status}}
       Fix me please :(
      {{/success}}
